# Сайт спортивных секций МАИ
## Описание
    Курсовой проект в рамках дисциплины Обучение служения команды из  группы М08-101БВ-25. Сайт Маёвских спортивных секций, созданный для облегчения поиска секций и информации о спортивных  мероприятиях МАИ, а также для более простого взаимодействия преподавателей и студентов
## Команда
    team_sport
## Состав и роли в команде
    - Слонова Анна Дмитриевна (Fullstack, дизайнер)
    - Базанова Виктория Александровна (Frontend, дизайнер)
    - Пантюхин Никита Олегович (Fullstack)
    - Павлов Кирилл Александрович (Backend, Тимлид)
    - Лобачёв Андрей Александрович (Backend)

## Цель
    Создать сайт спортивных секций МАИ для более простого взаимодействия студентов и преподавателей и записи в секции, а также поиска информации о спорте в МАИ

## Задачи
1. Дизайн:
 - Определить необходимые страницы и их содержание
 - Выбрать цветовую гамму
 - Создать интуитивно понятный макет страниц в Figme
2. Frontend:
 - Верстка страниц по уже готовому в Figme дизайну
 - Соединить backend и frontend
3. Backend:
 - Придумать структуру сайта
 - Разработка модулей
 - Разработка действий с секциями и тренировками

## Основный возможности сайта
 - Регистрация и вход в систему
 - Редактирование профиля
 - Просмотр мероприятий, секций и постов
 - Просмтр кайдой секции отдельно более подробно
 - Составление расписания тренировок
 - Просмотр трениром своей секции и студентов

## Технологии
 - **Язык**: Go 1.21+
- **База данных**: PostgreSQL
- **Миграции**: `goose`
- **HTTP-сервер**: `net/http` + middleware
- **DI**: ручное внедрение зависимостей
- **Контейнеризация**: Docker, Docker Compose
- **Сборка**: `Makefile`

## ClubController
Контроллер, отвечающий за взаимодействие с секциями 

### CreateClubHandler
Хэндлер, отвечающий за создание новой секции
1.  Обрабатывает **POST**-запрос на URL `/clubs/create`
    * В теле запроса **JSON-параметры**, необходимые для создания клуба (например: `name`, `description`, `sport_type_id`, `total_places`, `education_level_id` и т.д.).
2.  **Проверяет авторизацию:** Получает текущего пользователя. **Проверяет роль:** Доступ разрешен только пользователям с ролью `Teacher` (Учитель/Тренер) или `Admin` (Администратор).
3.  **Валидирует данные** запроса.
4.  **Создает в БД** новую секцию. Поле `teacher_id` (создатель секции) устанавливает равным ID текущего пользователя.
5.  В ответе **JSON** с полями созданного клуба:
    * `id`
    * `name`
    * `description`
    * `teacher_id`
    * ... (другие поля клуба)

---
### DeleteClubHandler
Хэндлер, отвечающий за удаление (мягкое удаление) секции
1.  Обрабатывает **DELETE**-запрос на URL `/clubs/{id}`
    * `{id}` — ID секции, которую необходимо удалить.
2.  **Проверяет авторизацию:** Получает текущего пользователя. **Проверяет роль:** Доступ разрешен только пользователям с ролью `Teacher` или `Admin`.
3.  **Проверяет существование** секции по `id`. Если не найдена — ошибка 404.
4.  **Проверяет владение (если не Admin):** Если роль пользователя `Teacher`, проверяет, что `teacher_id` секции совпадает с ID текущего пользователя (`CheckClubOwnership`). Если не совпадает — ошибка 403 (Forbidden).
5.  **Мягко удаляет** (`SoftDeleteClub`) секцию в БД, устанавливая флаг `is_deleted = TRUE`.
6.  В ответе **JSON** с подтверждением удаления:
    * `club_id`
    * `message: "Club deleted successfully"`

---

## WorkoutController
Контроллер, отвечающий за взаимодействие с тренировками


### GetClubWorkoutsHandler
Хэндлер, отвечающий за получение списка тренировок для конкретной секции
1.  Обрабатывает **GET**-запрос на URL `/clubs/{club_id}/workouts`
    * `{club_id}` — ID секции, тренировки которой необходимо получить.
2. **Получает из БД** тренировки, привязанные к данному `club_id`.
3. В ответе **JSON** с перечнем тренировок. Поля у каждой из тренировок:
    * `id`
    * `club_id`
    * `start_date`
    * `end_date`
    * `cancelled`
    * ... (другие поля тренировки)

---
### DeleteWorkoutHandler
Хэндлер, отвечающий за удаление (мягкое удаление) тренировки
1.  Обрабатывает **DELETE**-запрос на URL `/workouts/{id}`
    * `{id}` — ID тренировки, которую необходимо удалить.
2.  **Проверяет авторизацию:** Получает текущего пользователя. **Проверяет роль:** Доступ разрешен только пользователям с ролью `Teacher` или `Admin`.
3.  **Проверяет существование** тренировки по `id`. Если не найдена — ошибка 404.
4.  **Проверяет владение (если не Admin):**
    * Проверяет, что ID текущего пользователя совпадает с `teacher_id` клуба, к которому привязана тренировка (`CheckWorkoutOwnership`).
    * Если не совпадает — ошибка 403 (Forbidden).
5.  **Мягко удаляет** (`SoftDeleteWorkout`) тренировку в БД.
6.  В ответе **JSON** с подтверждением удаления:
    * `workout_id`
    * `message: "Workout deleted successfully"`

## ClubJoinRequestController
Контроллер, отвечающий за взаимодействие с заявками на вступление в секцию

### CreateJoinRequestHandler
Хэндлер, отвечающий за создание заявки на вступление в секцию
1. Обрабатывает POST-запрос на url ```/club_join_requests/create```
 - В теле запроса json-параметр ```club_id``` - id секции, в которую подаётся заявка
2. Проверяет, авторизован ли пользователь. Если нет - ошибка доступа. Если да - получает текущего пользователя
3. Добавляет в БД заявку в секцию. ```club_id``` получает из тела запроса, в ```user_id``` (id пользователя, подавшего заявку) подставляет id текущего пользователя, ```status``` (статус заявки) устанавливает в значение, предназначенное для заявок на рассмотрении
4. В ответе json с полями:
 - ```id```
 - ```club_id```
 - ```user_id```
 - ```status```


### GetJoinRequestsHandler
Хэндлер, отвечающий за получение заявок на вступление в секцию
1. Обрабатывает GET-запрос на url ```/club_join_requests/```

Опциональные query-параметры:
 - ```club_id``` - id секции, в которую подана заявка
 - ```user_id``` - id пользователя, подавшего заявку
 - ```id``` - id заявки
 - ```limit_``` - максимальное количество возвращаемых заявок (для пагинации)
 - ```offset_``` - смещение (для пагинации)
2. Проверяет, авторизован ли пользователь. Если нет - ошибка доступа. Если да - получает текущего пользователя
3. Получает из БД заявки, подходящие под следующие условия:
 - Текущий пользователь является создателем заявки или тренером в секции, на которую подана заявка
 - Если какие-либо из перечисленных query-параметров переданы, значения соответсивующих полей должны им соответсвовать
4. В ответе json с перечнем подходящих завявок. Поля у каждой из заявок:
 - ```id```
 - ```club_id```
 - ```user_id```
 - ```status```
 - ```created_at``` - время создания
 - ```updated_at``` - время последнего изменения
